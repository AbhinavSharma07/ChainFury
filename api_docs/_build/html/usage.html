<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Using ChainFury &mdash; ChainFury 0.1.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Agent File" href="source/chainfury.agent.html" />
    <link rel="prev" title="Installing ChainFury" href="install.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            ChainFury
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing ChainFury</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Using ChainFury</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#master-of-all-trades">Master of all trades</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-chains-in-python">Creating chains in python</a></li>
<li class="toctree-l2"><a class="reference internal" href="#calling-chain">Calling Chain</a></li>
<li class="toctree-l2"><a class="reference internal" href="#stream-chain">Stream Chain</a></li>
<li class="toctree-l2"><a class="reference internal" href="#superpowers-with-chainfury-server">Superpowers with chainfury server</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#put-the-chain-in-the-db">Put the chain in the DB</a></li>
<li class="toctree-l3"><a class="reference internal" href="#loading-chain-from-db">Loading Chain from DB</a></li>
<li class="toctree-l3"><a class="reference internal" href="#inference-via-api">Inference via API</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#conclusion">Conclusion</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python APIs:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="source/chainfury.agent.html">Agent File</a></li>
<li class="toctree-l1"><a class="reference internal" href="source/chainfury.cli.html">chainfury CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="source/chainfury.base.html">chainfury.base</a></li>
<li class="toctree-l1"><a class="reference internal" href="source/chainfury.client.html">chainfury.client</a></li>
<li class="toctree-l1"><a class="reference internal" href="source/chainfury.utils.html">chainfury utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="source/chainfury.version.html">Version</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Integrations:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="source/chainfury.components.html">chainfury Components</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">ChainFury</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Using ChainFury</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/usage.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="using-chainfury">
<h1>Using ChainFury<a class="headerlink" href="#using-chainfury" title="Permalink to this heading"></a></h1>
<p>ChainFury is a Python library for creating and manipulating automated agents. It is built ground up to be used in backend
services with superior user experience. This is a simple example script on how you can use the <cite>chainfury</cite>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="kn">from</span> <span class="nn">chainfury</span> <span class="kn">import</span> <span class="n">Chain</span><span class="p">,</span> <span class="n">ai_actions_registry</span><span class="p">,</span> <span class="n">Edge</span><span class="p">,</span> <span class="n">get_client</span><span class="p">,</span> <span class="n">Node</span>
<span class="kn">from</span> <span class="nn">chainfury.client</span> <span class="kn">import</span> <span class="n">create_new_chain</span><span class="p">,</span> <span class="n">get_chain_from_dict</span>  <span class="c1"># skip if not running chainfury server</span>
<span class="kn">from</span> <span class="nn">chainfury.types</span> <span class="kn">import</span> <span class="n">Dag</span>
</pre></div>
</div>
<section id="master-of-all-trades">
<h2>Master of all trades<a class="headerlink" href="#master-of-all-trades" title="Permalink to this heading"></a></h2>
<p>There are two different ways to create chains, one to create via the python package and other to create using the dashboard.
In this particular example we will show how you can use the <cite>chainfury</cite> package and server APIs to create, store, retrieve
and execute chains.</p>
<img alt="https://d2e931syjhr5o9.cloudfront.net/nbox/cf000.png" class="align-center" src="https://d2e931syjhr5o9.cloudfront.net/nbox/cf000.png" />
<p>It is so simple, you can create a chain from python use it from the dashboard or via an API on the <cite>chainfury</cite> server.</p>
</section>
<section id="creating-chains-in-python">
<h2>Creating chains in python<a class="headerlink" href="#creating-chains-in-python" title="Permalink to this heading"></a></h2>
<p>In this example we will create a dag that looks like this. <code class="code docutils literal notranslate"><span class="pre">man1,</span> <span class="pre">man2,</span> <span class="pre">tell_story</span></code> are the actions you want to take
and <code class="code docutils literal notranslate"><span class="pre">question</span></code> is what you send as the input from the chatbox and <code class="code docutils literal notranslate"><span class="pre">story</span></code> is the output that you get as an
output to the chatbox.</p>
<img alt="https://d2e931syjhr5o9.cloudfront.net/nbox/cf001.png" class="align-center" src="https://d2e931syjhr5o9.cloudfront.net/nbox/cf001.png" />
<p>You can start by copying the code below, to see in more details you can check out <a class="reference internal" href="source/chainfury.agent.html#chainfury.agent.ai_actions_registry" title="chainfury.agent.ai_actions_registry"><code class="xref py py-mod docutils literal notranslate"><span class="pre">chainfury.agent.ai_actions_registry</span></code></a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">man1</span> <span class="o">=</span> <span class="n">ai_actions_registry</span><span class="o">.</span><span class="n">to_action</span><span class="p">(</span>
   <span class="n">action_name</span> <span class="o">=</span> <span class="s2">&quot;man1&quot;</span><span class="p">,</span>
   <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;openai-chat&quot;</span><span class="p">,</span>
   <span class="n">model_params</span><span class="o">=</span><span class="p">{</span>
      <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;gpt-3.5-turbo&quot;</span><span class="p">,</span>
   <span class="p">},</span>
   <span class="n">fn</span><span class="o">=</span><span class="p">{</span>
      <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
               <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
               <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;You are a man who was running in the middle of desert. You see a mac donalds and the waiters you ask the questions: {{ question }}? You are pissed and you say&quot;</span><span class="p">,</span>
            <span class="p">},</span>
      <span class="p">],</span>
   <span class="p">},</span>
   <span class="n">outputs</span><span class="o">=</span><span class="p">{</span>
      <span class="s2">&quot;answer&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;choices&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">),</span>
   <span class="p">},</span>
<span class="p">)</span>

<span class="n">man2</span> <span class="o">=</span> <span class="n">ai_actions_registry</span><span class="o">.</span><span class="n">to_action</span><span class="p">(</span>
   <span class="n">action_name</span> <span class="o">=</span> <span class="s2">&quot;man2&quot;</span><span class="p">,</span>
   <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;openai-chat&quot;</span><span class="p">,</span>
   <span class="n">model_params</span><span class="o">=</span><span class="p">{</span>
      <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;gpt-3.5-turbo&quot;</span><span class="p">,</span>
   <span class="p">},</span>
   <span class="n">fn</span><span class="o">=</span><span class="p">{</span>
      <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
               <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
               <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s2">&quot;Someone comes upto you in a bar and screams &#39;{{ x }}&#39;? give a funny response to it.&quot;</span><span class="p">,</span>
            <span class="p">},</span>
      <span class="p">],</span>
   <span class="p">},</span>
   <span class="n">outputs</span><span class="o">=</span><span class="p">{</span>
      <span class="s2">&quot;out&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;choices&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">),</span>
   <span class="p">},</span>
<span class="p">)</span>

<span class="n">tell_story</span> <span class="o">=</span> <span class="n">ai_actions_registry</span><span class="o">.</span><span class="n">to_action</span><span class="p">(</span>
   <span class="n">action_name</span> <span class="o">=</span> <span class="s2">&quot;tell_story&quot;</span><span class="p">,</span>
   <span class="n">model_id</span><span class="o">=</span><span class="s2">&quot;openai-chat&quot;</span><span class="p">,</span>
   <span class="n">model_params</span><span class="o">=</span><span class="p">{</span>
      <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="s2">&quot;gpt-3.5-turbo&quot;</span><span class="p">,</span>
   <span class="p">},</span>
   <span class="n">fn</span><span class="o">=</span><span class="p">{</span>
      <span class="s2">&quot;messages&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
               <span class="s2">&quot;role&quot;</span><span class="p">:</span> <span class="s2">&quot;user&quot;</span><span class="p">,</span>
               <span class="s2">&quot;content&quot;</span><span class="p">:</span> <span class="s1">&#39;&#39;&#39;Two men were fighting in a bar.</span>
<span class="s1">One yelled &#39;{{ man1 }}&#39;.</span>

<span class="s1">Other responded by yelling &#39;{{ man2 }}&#39;.</span>

<span class="s1">Continue this story for 3 more lines.</span>
<span class="s1">&#39;&#39;&#39;</span><span class="p">,</span>
            <span class="p">},</span>
      <span class="p">],</span>
   <span class="p">},</span>
   <span class="n">outputs</span><span class="o">=</span><span class="p">{</span>
      <span class="s2">&quot;story&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;choices&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">),</span>
   <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Now try printing the three variables <code class="code docutils literal notranslate"><span class="pre">man1,</span> <span class="pre">man2,</span> <span class="pre">tell_story</span></code> and see what they contain. You should see something
like this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">FuryNode</span><span class="p">{</span> <span class="p">(</span><span class="s1">&#39;b7305e89-cdfd-49a2-87a6-11052fd61da5&#39;</span><span class="p">,</span> <span class="s1">&#39;ai-powered&#39;</span><span class="p">)</span> <span class="p">[</span>
      <span class="n">Var</span><span class="p">(</span><span class="o">*</span><span class="s1">&#39;question&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">[],</span> <span class="n">additionalProperties</span><span class="o">=</span><span class="p">[]),</span>
      <span class="n">Var</span><span class="p">(</span><span class="o">*</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">[],</span> <span class="n">additionalProperties</span><span class="o">=</span><span class="p">[]),</span>
      <span class="n">Var</span><span class="p">(</span><span class="o">*</span><span class="s1">&#39;messages&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">array</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">[</span><span class="n">Var</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">object</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">[],</span> <span class="n">additionalProperties</span><span class="o">=</span><span class="n">Var</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">[],</span> <span class="n">additionalProperties</span><span class="o">=</span><span class="p">[]))],</span> <span class="n">additionalProperties</span><span class="o">=</span><span class="p">[]),</span>
<span class="p">]</span> <span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">[</span>
      <span class="n">Var</span><span class="p">(</span><span class="s1">&#39;answer&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">[],</span> <span class="n">additionalProperties</span><span class="o">=</span><span class="p">[]),</span>
<span class="p">]</span> <span class="p">},</span>
<span class="n">FuryNode</span><span class="p">{</span> <span class="p">(</span><span class="s1">&#39;83165745-f948-4262-9592-fd8c3120fa11&#39;</span><span class="p">,</span> <span class="s1">&#39;ai-powered&#39;</span><span class="p">)</span> <span class="p">[</span>
      <span class="n">Var</span><span class="p">(</span><span class="o">*</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">[],</span> <span class="n">additionalProperties</span><span class="o">=</span><span class="p">[]),</span>
      <span class="n">Var</span><span class="p">(</span><span class="o">*</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">[],</span> <span class="n">additionalProperties</span><span class="o">=</span><span class="p">[]),</span>
      <span class="n">Var</span><span class="p">(</span><span class="o">*</span><span class="s1">&#39;messages&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">array</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">[</span><span class="n">Var</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">object</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">[],</span> <span class="n">additionalProperties</span><span class="o">=</span><span class="n">Var</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">[],</span> <span class="n">additionalProperties</span><span class="o">=</span><span class="p">[]))],</span> <span class="n">additionalProperties</span><span class="o">=</span><span class="p">[]),</span>
<span class="p">]</span> <span class="p">(</span><span class="mi">15</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">[</span>
      <span class="n">Var</span><span class="p">(</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">[],</span> <span class="n">additionalProperties</span><span class="o">=</span><span class="p">[]),</span>
<span class="p">]</span> <span class="p">},</span>
<span class="n">FuryNode</span><span class="p">{</span> <span class="p">(</span><span class="s1">&#39;a0946f6f-2be6-41c9-9fac-389490436958&#39;</span><span class="p">,</span> <span class="s1">&#39;ai-powered&#39;</span><span class="p">)</span> <span class="p">[</span>
      <span class="n">Var</span><span class="p">(</span><span class="o">*</span><span class="s1">&#39;man1&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">[],</span> <span class="n">additionalProperties</span><span class="o">=</span><span class="p">[]),</span>
      <span class="n">Var</span><span class="p">(</span><span class="o">*</span><span class="s1">&#39;man2&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">[],</span> <span class="n">additionalProperties</span><span class="o">=</span><span class="p">[]),</span>
      <span class="n">Var</span><span class="p">(</span><span class="o">*</span><span class="s1">&#39;model&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">[],</span> <span class="n">additionalProperties</span><span class="o">=</span><span class="p">[]),</span>
      <span class="n">Var</span><span class="p">(</span><span class="o">*</span><span class="s1">&#39;messages&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">array</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">[</span><span class="n">Var</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">object</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">[],</span> <span class="n">additionalProperties</span><span class="o">=</span><span class="n">Var</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">[],</span> <span class="n">additionalProperties</span><span class="o">=</span><span class="p">[]))],</span> <span class="n">additionalProperties</span><span class="o">=</span><span class="p">[]),</span>
<span class="p">]</span> <span class="p">(</span><span class="mi">16</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">[</span>
      <span class="n">Var</span><span class="p">(</span><span class="s1">&#39;story&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">items</span><span class="o">=</span><span class="p">[],</span> <span class="n">additionalProperties</span><span class="o">=</span><span class="p">[]),</span>
<span class="p">]</span> <span class="p">})</span>
</pre></div>
</div>
<p>Now we can create a chain as simple as this:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">story_bot</span> <span class="o">=</span> <span class="n">Chain</span><span class="p">(</span>
   <span class="p">[</span><span class="n">man1</span><span class="p">,</span> <span class="n">man2</span><span class="p">,</span> <span class="n">tell_story</span><span class="p">],</span>
   <span class="p">[</span>
      <span class="n">Edge</span><span class="p">(</span><span class="n">man1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;answer&quot;</span><span class="p">,</span> <span class="n">man2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">),</span>
      <span class="n">Edge</span><span class="p">(</span><span class="n">man1</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;answer&quot;</span><span class="p">,</span> <span class="n">tell_story</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;man1&quot;</span><span class="p">),</span>
      <span class="n">Edge</span><span class="p">(</span><span class="n">man2</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;out&quot;</span><span class="p">,</span> <span class="n">tell_story</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;man2&quot;</span><span class="p">),</span>
   <span class="p">],</span>
   <span class="n">sample</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;question&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">},</span>
   <span class="n">main_in</span><span class="o">=</span><span class="s2">&quot;question&quot;</span><span class="p">,</span>
   <span class="n">main_out</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tell_story</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">/story&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Notice how we define the entire dag by defining the nodes and the edges. For sanity we also take in a sample input with
<code class="code docutils literal notranslate"><span class="pre">main_in</span></code> value, ie. <code class="code docutils literal notranslate"><span class="pre">question</span></code> and tell the <code class="code docutils literal notranslate"><span class="pre">main_out</span></code> ie. <code class="code docutils literal notranslate"><span class="pre">{tell_story.id}/story</span></code>. When you
print the <code class="code docutils literal notranslate"><span class="pre">story_bot</span></code> this is what you will get:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">FuryDag</span><span class="p">(</span>
   <span class="n">nodes</span><span class="p">:</span> <span class="p">[</span>
      <span class="n">b7305e89</span><span class="o">-</span><span class="n">cdfd</span><span class="o">-</span><span class="mi">49</span><span class="n">a2</span><span class="o">-</span><span class="mi">87</span><span class="n">a6</span><span class="o">-</span><span class="mi">11052</span><span class="n">fd61da5</span><span class="p">,</span>
      <span class="mi">83165745</span><span class="o">-</span><span class="n">f948</span><span class="o">-</span><span class="mi">4262</span><span class="o">-</span><span class="mi">9592</span><span class="o">-</span><span class="n">fd8c3120fa11</span><span class="p">,</span>
      <span class="n">a0946f6f</span><span class="o">-</span><span class="mi">2</span><span class="n">be6</span><span class="o">-</span><span class="mi">41</span><span class="n">c9</span><span class="o">-</span><span class="mi">9</span><span class="n">fac</span><span class="o">-</span><span class="mi">389490436958</span><span class="p">,</span>
   <span class="p">],</span>
   <span class="n">edges</span><span class="p">:</span> <span class="p">[</span>
      <span class="n">FuryEdge</span><span class="p">(</span><span class="s1">&#39;b7305e89-cdfd-49a2-87a6-11052fd61da5/answer&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;83165745-f948-4262-9592-fd8c3120fa11/x&#39;</span><span class="p">),</span>
      <span class="n">FuryEdge</span><span class="p">(</span><span class="s1">&#39;b7305e89-cdfd-49a2-87a6-11052fd61da5/answer&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;a0946f6f-2be6-41c9-9fac-389490436958/man1&#39;</span><span class="p">),</span>
      <span class="n">FuryEdge</span><span class="p">(</span><span class="s1">&#39;83165745-f948-4262-9592-fd8c3120fa11/out&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;a0946f6f-2be6-41c9-9fac-389490436958/man2&#39;</span><span class="p">),</span>
   <span class="p">]</span>
   <span class="n">main_in</span><span class="p">:</span> <span class="n">question</span>
   <span class="n">main_out</span><span class="p">:</span> <span class="n">a0946f6f</span><span class="o">-</span><span class="mi">2</span><span class="n">be6</span><span class="o">-</span><span class="mi">41</span><span class="n">c9</span><span class="o">-</span><span class="mi">9</span><span class="n">fac</span><span class="o">-</span><span class="mi">389490436958</span><span class="o">/</span><span class="n">story</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="calling-chain">
<h2>Calling Chain<a class="headerlink" href="#calling-chain" title="Permalink to this heading"></a></h2>
<p>Calling the chain in a blocking fashion is super simple, you can just call the chain by passing the input string. Each call
will return the final output as well as all the intermediate steps. For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">out</span><span class="p">,</span> <span class="n">thoughts</span> <span class="o">=</span> <span class="n">story_bot</span><span class="p">(</span><span class="s2">&quot;nice earrings!&quot;</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">thoughts</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
<p>In this you will get response like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;83165745-f948-4262-9592-fd8c3120fa11/out&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="s1">&#39;2023-07-04T10:54:27.956500&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;&quot;Well, I may not have ...&#39;</span><span class="p">},</span>
<span class="s1">&#39;a0946f6f-2be6-41c9-9fac-389490436958/story&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="s1">&#39;2023-07-04T10:54:33.322340&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;As the two men ...&#39;</span><span class="p">},</span>
<span class="s1">&#39;b7305e89-cdfd-49a2-87a6-11052fd61da5/answer&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="s1">&#39;2023-07-04T10:54:25.724288&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;&quot;No, I don</span><span class="se">\&#39;</span><span class="s1">t have ...&#39;</span><span class="p">}}</span>
<span class="o">----</span>
<span class="n">As</span> <span class="n">the</span> <span class="n">two</span> <span class="n">men</span> <span class="n">continued</span> <span class="n">to</span> <span class="n">exchange</span> <span class="n">loud</span> <span class="n">words</span><span class="p">,</span> <span class="n">the</span> <span class="n">entire</span> <span class="n">bar</span> <span class="n">fell</span> <span class="n">into</span> <span class="n">an</span> <span class="n">attentive</span> <span class="n">silence</span><span class="o">.</span> <span class="n">The</span> <span class="n">onlookers</span> <span class="n">couldn</span><span class="s1">&#39;t</span>
<span class="n">help</span> <span class="n">but</span> <span class="n">be</span> <span class="n">intrigued</span> <span class="n">by</span> <span class="n">the</span> <span class="n">strange</span> <span class="n">twist</span> <span class="n">the</span> <span class="n">conversation</span> <span class="n">had</span> <span class="n">taken</span><span class="o">.</span> <span class="n">They</span> <span class="n">leaned</span> <span class="ow">in</span> <span class="n">closer</span><span class="p">,</span> <span class="n">eagerly</span> <span class="n">awaiting</span> <span class="n">the</span> <span class="nb">next</span>
<span class="n">words</span> <span class="n">to</span> <span class="n">be</span> <span class="n">hurled</span> <span class="n">across</span> <span class="n">the</span> <span class="n">room</span><span class="o">.</span> <span class="n">Suddenly</span><span class="p">,</span> <span class="n">a</span> <span class="n">wise</span> <span class="n">old</span> <span class="n">man</span> <span class="n">sitting</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">corner</span> <span class="n">table</span> <span class="n">interrupted</span> <span class="n">the</span> <span class="n">escalating</span>
<span class="n">argument</span><span class="o">.</span> <span class="n">His</span> <span class="n">weathered</span> <span class="n">face</span> <span class="n">held</span> <span class="n">the</span> <span class="n">weight</span> <span class="n">of</span> <span class="n">countless</span> <span class="n">tales</span><span class="o">.</span> <span class="n">With</span> <span class="n">a</span> <span class="n">calm</span> <span class="n">yet</span> <span class="n">commanding</span> <span class="n">tone</span><span class="p">,</span> <span class="n">he</span> <span class="n">said</span><span class="p">,</span> <span class="s2">&quot;Gentlemen,</span>
<span class="n">instead</span> <span class="n">of</span> <span class="n">engaging</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">pointless</span> <span class="n">brawl</span><span class="p">,</span> <span class="n">let</span> <span class="n">me</span> <span class="n">share</span> <span class="n">a</span> <span class="n">true</span> <span class="n">story</span> <span class="n">that</span> <span class="n">will</span> <span class="n">quench</span> <span class="n">your</span> <span class="n">thirst</span> <span class="k">for</span> <span class="n">adventure</span> <span class="ow">and</span>
\<span class="n">teach</span> <span class="n">you</span> <span class="n">the</span> <span class="n">value</span> <span class="n">of</span> <span class="n">compassion</span><span class="o">.</span><span class="s2">&quot; With the bar now captivated by the storyteller&#39;s presence, the clashing egos were</span>
<span class="n">replaced</span> <span class="n">by</span> <span class="n">curiosity</span> <span class="ow">and</span> <span class="n">anticipation</span><span class="o">.</span> <span class="n">Little</span> <span class="n">did</span> <span class="n">anyone</span> <span class="n">know</span><span class="p">,</span> <span class="n">this</span> <span class="n">chance</span> <span class="n">encounter</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">bar</span> <span class="n">would</span> <span class="n">lead</span> <span class="n">to</span> <span class="n">an</span>
<span class="n">extraordinary</span> <span class="n">journey</span><span class="p">,</span> <span class="n">bound</span> <span class="n">to</span> <span class="n">leave</span> <span class="n">a</span> <span class="n">lasting</span> <span class="n">impact</span> <span class="n">on</span> <span class="n">the</span> <span class="n">lives</span> <span class="n">of</span> <span class="n">everyone</span> <span class="n">involved</span><span class="o">.</span>
</pre></div>
</div>
<p>You can read more about it in <a class="reference internal" href="source/chainfury.base.html#chainfury.base.Chain.__call__" title="chainfury.base.Chain.__call__"><code class="xref py py-mod docutils literal notranslate"><span class="pre">chainfury.base.Chain.__call__</span></code></a>.</p>
</section>
<section id="stream-chain">
<h2>Stream Chain<a class="headerlink" href="#stream-chain" title="Permalink to this heading"></a></h2>
<p>Now you can also get the responses from the chain as each step is executed. In order to do that you will have to modify your code
to handle an iterator. You can read more in <a class="reference internal" href="source/chainfury.base.html#chainfury.base.Chain.stream" title="chainfury.base.Chain.stream"><code class="xref py py-mod docutils literal notranslate"><span class="pre">chainfury.base.Chain.stream</span></code></a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cf_stream_response</span> <span class="o">=</span> <span class="n">story_bot</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="s2">&quot;nice earrings!&quot;</span><span class="p">)</span>

<span class="n">out</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">thoughts</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">ir</span><span class="p">,</span> <span class="n">done</span> <span class="ow">in</span> <span class="n">cf_stream_response</span><span class="p">:</span>
   <span class="k">if</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>
      <span class="n">thoughts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ir</span><span class="p">)</span>
      <span class="n">pprint</span><span class="p">(</span><span class="n">ir</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">out</span> <span class="o">=</span> <span class="n">ir</span>

<span class="c1"># use out and thoughts just like a normal call</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice the dict by dict prints instead of a single large dictionary with all keys:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;b7305e89-cdfd-49a2-87a6-11052fd61da5/answer&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="s1">&#39;2023-07-04T10:54:35.857234&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;&quot;Nice earrings? Are ...&#39;</span>
                                                <span class="p">}}</span>
<span class="p">{</span><span class="s1">&#39;83165745-f948-4262-9592-fd8c3120fa11/out&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="s1">&#39;2023-07-04T10:54:39.355871&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;Well, it seems like ...&#39;</span>
                                             <span class="p">}}</span>
<span class="p">{</span><span class="s1">&#39;a0946f6f-2be6-41c9-9fac-389490436958/story&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="s1">&#39;2023-07-04T10:54:43.044220&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;The man in need of ...&#39;</span>
                                                <span class="p">}}</span>
<span class="o">----</span>
<span class="n">The</span> <span class="n">man</span> <span class="ow">in</span> <span class="n">need</span> <span class="n">of</span> <span class="n">water</span> <span class="ow">and</span> <span class="n">food</span> <span class="n">couldn</span><span class="s1">&#39;t help but burst into laughter at the unexpected solution. He appreciated the</span>
<span class="n">cleverness</span> <span class="ow">and</span> <span class="n">humor</span> <span class="ow">in</span> <span class="n">his</span> <span class="n">opponent</span><span class="s1">&#39;s response. Their tense faces softened as they realized the absurdity of their</span>
<span class="n">argument</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">midst</span> <span class="n">of</span> <span class="n">their</span> <span class="n">shared</span> <span class="n">predicament</span><span class="o">.</span> <span class="n">They</span> <span class="n">both</span> <span class="n">agreed</span> <span class="n">to</span> <span class="nb">set</span> <span class="n">aside</span> <span class="n">their</span> <span class="n">differences</span> <span class="ow">and</span> <span class="nb">set</span> <span class="n">off</span> <span class="ow">in</span> <span class="n">search</span>
<span class="n">of</span> <span class="n">the</span> <span class="n">nearest</span> <span class="n">oasis</span><span class="p">,</span> <span class="n">sharing</span> <span class="n">a</span> <span class="n">newfound</span> <span class="n">camaraderie</span> <span class="n">along</span> <span class="n">the</span> <span class="n">way</span><span class="o">.</span> <span class="n">And</span> <span class="n">so</span><span class="p">,</span> <span class="n">the</span> <span class="n">bar</span> <span class="n">altercation</span> <span class="n">evolved</span> <span class="n">into</span> <span class="n">an</span> <span class="n">unlikely</span>
<span class="n">bond</span> <span class="n">forged</span> <span class="n">by</span> <span class="n">thirst</span><span class="p">,</span> <span class="n">hunger</span><span class="p">,</span> <span class="ow">and</span> <span class="n">a</span> <span class="n">pair</span> <span class="n">of</span> <span class="n">watermelon</span> <span class="n">earrings</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="superpowers-with-chainfury-server">
<h2>Superpowers with chainfury server<a class="headerlink" href="#superpowers-with-chainfury-server" title="Permalink to this heading"></a></h2>
<p>This is only applicable when you are also using the <cite>chainfury</cite> server. If you are not then you can skip this section.</p>
<section id="put-the-chain-in-the-db">
<h3>Put the chain in the DB<a class="headerlink" href="#put-the-chain-in-the-db" title="Permalink to this heading"></a></h3>
<p>Once you are confident that chain you have built works and you want others to use this chain you can put it in the DB.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">chain_db</span> <span class="o">=</span> <span class="n">create_new_chain</span><span class="p">(</span><span class="s2">&quot;funny_story&quot;</span><span class="p">,</span> <span class="n">story_bot</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">chain_db</span><span class="p">)</span>

<span class="p">{</span>
   <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;funny_story&#39;</span><span class="p">,</span>
   <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
   <span class="s1">&#39;dag&#39;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s1">&#39;nodes&#39;</span><span class="p">:</span> <span class="p">[</span>
         <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;b7305e89-cdfd-49a2-87a6-11052fd61da5&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">},</span>
         <span class="o">...</span>
      <span class="p">],</span>
      <span class="s1">&#39;edges&#39;</span><span class="p">:</span> <span class="p">[</span>
         <span class="p">{</span><span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;b7305e89-cdfd-49a2-87a6-11052fd61da5/answer-83165745-f948-4262-9592-fd8c3120fa11x&#39;</span><span class="p">,</span> <span class="o">...</span><span class="p">},</span>
         <span class="o">...</span>
      <span class="p">],</span>
      <span class="s1">&#39;sample&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;question&#39;</span><span class="p">:</span> <span class="s1">&#39;&#39;</span><span class="p">},</span>
      <span class="s1">&#39;main_in&#39;</span><span class="p">:</span> <span class="s1">&#39;question&#39;</span><span class="p">,</span>
      <span class="s1">&#39;main_out&#39;</span><span class="p">:</span> <span class="s1">&#39;a0946f6f-2be6-41c9-9fac-389490436958/story&#39;</span>
   <span class="p">},</span>
   <span class="s1">&#39;engine&#39;</span><span class="p">:</span> <span class="s1">&#39;fury&#39;</span><span class="p">,</span>
   <span class="s1">&#39;deleted_at&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
   <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="s1">&#39;efs5w2mz&#39;</span><span class="p">,</span>
   <span class="s1">&#39;created_by&#39;</span><span class="p">:</span> <span class="s1">&#39;ng54wyxa&#39;</span><span class="p">,</span>
   <span class="s1">&#39;meta&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
   <span class="s1">&#39;created_at&#39;</span><span class="p">:</span> <span class="s1">&#39;2023-07-04T10:54:43.071866&#39;</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="loading-chain-from-db">
<h3>Loading Chain from DB<a class="headerlink" href="#loading-chain-from-db" title="Permalink to this heading"></a></h3>
<p>You need to know the chatbot ID from the database that you can then use to load up the chain and use it as if you build it
using python. This flexibililty allows <cite>chainfury</cite> to be used in several different system architectures. To load a chain
from DB it is as simple as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">chain</span> <span class="o">=</span> <span class="n">Chain</span><span class="o">.</span><span class="n">from_id</span><span class="p">(</span><span class="n">chain_db</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>

<span class="n">cf_stream_response</span> <span class="o">=</span> <span class="n">chain</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="s2">&quot;why do you have a dry throat?&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;cf_stream_response:&quot;</span><span class="p">,</span> <span class="n">cf_stream_response</span><span class="p">)</span>

<span class="n">out</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">thoughts</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">ir</span><span class="p">,</span> <span class="n">done</span> <span class="ow">in</span> <span class="n">cf_stream_response</span><span class="p">:</span>
   <span class="k">if</span> <span class="ow">not</span> <span class="n">done</span><span class="p">:</span>
      <span class="n">thoughts</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">ir</span><span class="p">)</span>
      <span class="n">pprint</span><span class="p">(</span><span class="n">ir</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">out</span> <span class="o">=</span> <span class="n">ir</span>

<span class="c1"># use out and thoughts just like a normal call</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</pre></div>
</div>
<p>Then you can stream the response just like above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="s1">&#39;b7305e89-cdfd-49a2-87a6-11052fd61da5/answer&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="s1">&#39;2023-07-04T10:54:45.501326&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;&quot;Excuse me, but why ...&#39;</span>
                                                <span class="p">}}</span>
<span class="p">{</span><span class="s1">&#39;83165745-f948-4262-9592-fd8c3120fa11/out&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="s1">&#39;2023-07-04T10:54:47.984287&#39;</span><span class="p">,</span>
                                             <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s1">&#39;Well, it sounds like ...&#39;</span>
                                             <span class="p">}}</span>
<span class="p">{</span><span class="s1">&#39;a0946f6f-2be6-41c9-9fac-389490436958/story&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="s1">&#39;2023-07-04T10:54:53.386416&#39;</span><span class="p">,</span>
                                                <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="s2">&quot;The first man&#39;s ...&quot;</span>
                                                <span class="p">}}</span>
<span class="o">----</span>
<span class="n">The</span> <span class="n">first</span> <span class="n">man</span><span class="s1">&#39;s frustration subsided for a moment as he couldn&#39;</span><span class="n">t</span> <span class="n">help</span> <span class="n">but</span> <span class="n">crack</span> <span class="n">a</span> <span class="n">smile</span> <span class="n">at</span> <span class="n">the</span> <span class="n">clever</span> <span class="n">response</span><span class="o">.</span> <span class="s2">&quot;You&#39;ve</span>
<span class="n">got</span> <span class="n">a</span> <span class="n">point</span> <span class="n">there</span><span class="p">,</span><span class="s2">&quot; he replied, wiping the sweat off his brow. &quot;</span><span class="n">Guess</span> <span class="n">I</span><span class="s1">&#39;ll have to settle for a cold glass of water</span>
<span class="n">when</span> <span class="n">I</span> <span class="k">finally</span> <span class="n">make</span> <span class="n">it</span> <span class="n">out</span> <span class="n">of</span> <span class="n">here</span><span class="o">.</span><span class="s2">&quot;</span>

<span class="n">As</span> <span class="n">the</span> <span class="n">two</span> <span class="n">men</span> <span class="n">continued</span> <span class="n">their</span> <span class="n">banter</span><span class="p">,</span> <span class="n">their</span> <span class="n">voices</span> <span class="n">softened</span><span class="p">,</span> <span class="ow">and</span> <span class="n">the</span> <span class="n">tension</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">bar</span> <span class="n">began</span> <span class="n">to</span> <span class="n">ease</span><span class="o">.</span> <span class="n">They</span> <span class="n">realized</span>
<span class="n">that</span> <span class="n">their</span> <span class="n">shared</span> <span class="n">experience</span> <span class="n">had</span> <span class="n">brought</span> <span class="n">about</span> <span class="n">a</span> <span class="n">strange</span> <span class="n">camaraderie</span> <span class="n">amidst</span> <span class="n">the</span> <span class="n">chaos</span><span class="o">.</span> <span class="n">It</span> <span class="n">was</span> <span class="k">as</span> <span class="k">if</span> <span class="n">the</span> <span class="n">scorching</span> <span class="n">desert</span>
<span class="n">had</span> <span class="n">forged</span> <span class="n">an</span> <span class="n">unlikely</span> <span class="n">bond</span> <span class="n">between</span> <span class="n">them</span><span class="o">.</span>

<span class="n">With</span> <span class="n">a</span> <span class="n">newfound</span> <span class="n">solidarity</span><span class="p">,</span> <span class="n">they</span> <span class="n">made</span> <span class="n">a</span> <span class="n">pact</span> <span class="n">to</span> <span class="n">conquer</span> <span class="n">the</span> <span class="n">relentless</span> <span class="n">desert</span> <span class="n">together</span><span class="o">.</span> <span class="n">They</span> <span class="n">raised</span> <span class="n">their</span> <span class="n">glasses</span><span class="p">,</span>
<span class="n">empty</span> <span class="n">though</span> <span class="n">they</span> <span class="n">were</span><span class="p">,</span> <span class="ow">and</span> <span class="n">toasted</span> <span class="n">to</span> <span class="n">their</span> <span class="n">unexpected</span> <span class="n">friendship</span><span class="o">.</span> <span class="n">In</span> <span class="n">that</span> <span class="n">moment</span><span class="p">,</span> <span class="n">they</span> <span class="n">knew</span> <span class="n">that</span> <span class="n">no</span> <span class="n">matter</span> <span class="n">the</span>
<span class="n">challenges</span> <span class="n">ahead</span><span class="p">,</span> <span class="n">they</span> <span class="n">were</span> <span class="n">no</span> <span class="n">longer</span> <span class="n">alone</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">vast</span> <span class="n">expanse</span> <span class="n">of</span> <span class="n">the</span> <span class="n">Mojave</span> <span class="n">Desert</span><span class="o">.</span>
</pre></div>
</div>
<p>The optimal way to use this setup is in the backend where you don’t want to hardcode the chains in your codebase but
still be able to execute it by pulling from the DB.</p>
</section>
<section id="inference-via-api">
<h3>Inference via API<a class="headerlink" href="#inference-via-api" title="Permalink to this heading"></a></h3>
<p>If you know the chatbot ID which you have from the previous step then you can also all the API in which case the chain
will be executed on the server itself.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">stub</span> <span class="o">=</span> <span class="n">get_client</span><span class="p">()</span>
<span class="n">prompt_fn</span> <span class="o">=</span> <span class="n">stub</span><span class="o">.</span><span class="n">chatbot</span><span class="o">.</span><span class="n">u</span><span class="p">(</span><span class="n">chain_db</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">prompt</span>

<span class="n">out</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">prompt_fn</span><span class="p">(</span><span class="s2">&quot;post&quot;</span><span class="p">,</span> <span class="n">json</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;session_id&quot;</span><span class="p">:</span> <span class="s2">&quot;random-uuid&quot;</span><span class="p">,</span> <span class="s2">&quot;new_message&quot;</span><span class="p">:</span> <span class="s2">&quot;GET&quot;</span><span class="p">})</span>
<span class="k">if</span> <span class="n">err</span><span class="p">:</span>
   <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ERROR:&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
   <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OUTPUT:&quot;</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
   <span class="k">raise</span>
<span class="n">out</span>
</pre></div>
</div>
<p>You will get a response that looks something like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="s1">&#39;The men</span><span class="se">\&#39;</span><span class="s1">s argument intensified, filled with anger and frustration. As they shouted insults back and forth &#39;</span>
          <span class="s1">&#39;the entire bar fell into an uneasy silence, everyone</span><span class="se">\&#39;</span><span class="s1">s eyes fixated on the escalating confrontation. A &#39;</span>
          <span class="s1">&#39;sense of impending chaos hung in the air, threatening to shatter the peace within the establishment.</span><span class="se">\n\n</span><span class="s1">But &#39;</span>
          <span class="s1">&#39;then, unexpectedly, a wise old man seated at the corner of the bar interjected, his voice calm yet commanding. &#39;</span>
          <span class="s1">&#39;&quot;Gentlemen, perhaps it is not the desert or its dry humor to blame,&quot; he said softly. &quot;Maybe, deep down, both &#39;</span>
          <span class="s1">&#39;of you are searching for something more than just water in this arid landscape.&quot;</span><span class="se">\n\n</span><span class="s1">His words lingered in the &#39;</span>
          <span class="s1">&#39;air, slowly diffusing the tension within the bar. The two fighters exchanged puzzled glances, their anger &#39;</span>
          <span class="s1">&#39;momentarily subsiding as they contemplated the old man</span><span class="se">\&#39;</span><span class="s1">s wisdom. Suddenly, a realization dawned upon them, &#39;</span>
          <span class="s1">&#39;reminding them of their shared humanity.&#39;</span><span class="p">,</span>
<span class="s1">&#39;thought&#39;</span><span class="p">:</span> <span class="p">[{</span><span class="s1">&#39;engine&#39;</span><span class="p">:</span> <span class="s1">&#39;fury&#39;</span><span class="p">,</span>
   <span class="s1">&#39;ir_steps&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
   <span class="s1">&#39;thoughts&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;be616dbe-ee7f-4b28-87a7-c60a185b6406/answer&#39;</span><span class="p">,</span>
   <span class="s1">&#39;cb5d15e7-4e53-4efa-bf31-9c316acf7840/out&#39;</span><span class="p">,</span>
   <span class="s1">&#39;9d4e1328-a18a-4e10-8396-8c349d2d818c/story&#39;</span><span class="p">]}],</span>
<span class="s1">&#39;num_tokens&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="s1">&#39;prompt_id&#39;</span><span class="p">:</span> <span class="mi">17823285</span><span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this heading"></a></h2>
<p>Now you are ready to use <cite>chainfury</cite>. This system is capable of building complex chains either from:
* dashboard
* python package</p>
<p>Then you can then use this chain from either from:
* python: by directly calling the chain
* python: loading the chain from the DB and executing it
* API: the server can also execute the chain and return the results</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="install.html" class="btn btn-neutral float-left" title="Installing ChainFury" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="source/chainfury.agent.html" class="btn btn-neutral float-right" title="Agent File" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, NimbleBox Engineering.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>